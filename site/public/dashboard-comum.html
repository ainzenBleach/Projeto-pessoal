<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Style/style-dashboard-comun.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Document</title>
</head>
<body onload="carregar()">
    <div class="dashboard">
        <div class="painel">
          <div id="mensagem_boas_vindas">
            
          </div>
            

            <div class="escolha_filtro" id="scroll_post">

            </div>

            <button onclick="sair()" class="botao-sair">Sair</button>
        </div>
        <div class="quadro">
            <div id="grafico_up" class="grafico_tipo_conta">
                <canvas id="grafico_1" style="width: 450px;">
                </canvas>
            </div>
            <div id="grafico_comentario" class="grafico_total_conta">
                <canvas id="grafico_2" style="width: 450px;">
                </canvas>
            </div>
        </div>

    </div>
</body>
</html>

<script>

function carregar(){
  const idUsuario = sessionStorage.ID_USUARIO

  var div_mensagem = document.getElementById("mensagem_boas_vindas")

  div_mensagem.innerHTML = `<h3>Bem vindo, ${sessionStorage.NOME_USUARIO}</h3>`
  
  fetch(`/dashComun/carregarDashUsuario/${idUsuario}`, {
    method: "GET"
  })
  .then(
    res => { res.json()
      
  .then(json => {

      var div_mensagem = document.getElementById("scroll_post")

      var InformacoesDash = json

      for(var i = 1; i <= InformacoesDash[0].postCriados; i++){
        
        idPost = i

        div_mensagem.innerHTML += `<button id="post_button" onclick="dashComun(${idPost})">post ${i}</button>`
      
      }

    })}
  )

}

function dashComun(idPost){

    fetch(`/dashComun/carregarUpDownUsuario/${idPost}`, {
    method: "GET"
  })
  .then(
    res => { res.json()
      
  .then(json => {

      var InformacoesUpDown = json
      

      var up = Number(InformacoesUpDown[0].CurtidaUP) 
      var down = Number(InformacoesUpDown[0].CurtidasDown)

      grafico.data.datasets[0].data = [up,down];
      grafico.update()

    })}
  )

    fetch(`/dashComun/carregarComentariosUsuario/${idPost}`, {
    method: "GET"
  })
  .then(
    res => { res.json()
      
  .then(json => {

      var InformacoesComentario = json
     
    
    var comentarios = InformacoesComentario[0].TotalDeComentarios

      grafico_2.data.datasets[0].data = [comentarios];
      grafico_2.update()

    })}
  )

}    
  const ctx = document.getElementById('grafico_1');

  var grafico = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ["Up","Down"],
      datasets: [{
        label: `Quantidade de Ups e Downs no post`,
        data: [],
        borderWidth: 1
      }
    ]
    },
    options: {

      scales: {
        y: {
          ticks:{
            stepSize:1,
            callback: function (value){
              return Math.floor(value)
            }
          },
          beginAtZero: true
        },
      }
    }
  });

  const grafico2 = document.getElementById('grafico_2');

  var grafico_2 = new Chart(grafico2, {
    type: 'bar',
    data: {
      labels: ["comentarios no post"],
      datasets: [{
        label: `Quantidade de comentarios`,
        data: [],
        borderWidth: 1
      }
    ]
    },
    options: {

      scales: {
        y: {
          ticks:{
            stepSize:1,
            callback: function (value){
              return Math.floor(value)
            }
          },
          beginAtZero: true
        },
      }
    }
  });

  function sair(){
    window.location.href = "index.html"
  }
</script>
 
